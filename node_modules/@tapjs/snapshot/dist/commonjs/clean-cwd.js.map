{"version":3,"file":"clean-cwd.js","sourceRoot":"","sources":["../../src/clean-cwd.ts"],"names":[],"mappings":";;;AAAA,sCAAiC;AACjC,uCAAwC;AAExC,6CAA6C;AAC7C,yBAAyB;AACzB,MAAM,GAAG,GAAG,CAAC,CAAS,EAAE,EAAE;IACxB,MAAM,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAA;IAC3B,OAAO,CAAC,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,CAAA;AACrC,CAAC,CAAA;AACD,MAAM,MAAM,GAAG,MAAM,CAAC,IAAA,wBAAa,EAAC,UAAG,CAAC,CAAC,CAAC,SAAS,CAAC,SAAS,CAAC,MAAM,CAAC,CAAA;AACrE,MAAM,QAAQ,GAAG,UAAG,CAAC,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC,CAAA;AACxC,MAAM,QAAQ,GAAG,UAAG,CAAC,WAAW,EAAE,CAAA;AAClC,MAAM,aAAa,GAAG,QAAQ,CAAC,WAAW,EAAE,CAAA;AAC5C,MAAM,IAAI,GAAG,IAAI,GAAG,CAAC,CAAC,MAAM,EAAE,UAAG,EAAE,QAAQ,EAAE,QAAQ,EAAE,aAAa,CAAC,CAAC,CAAA;AACtE,KAAK,MAAM,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,EAAE;IACzB,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAA;IAChB,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;IACrB,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;IAC1B,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;CAChC;AAEM,MAAM,QAAQ,GAAG,CAAC,IAAY,EAAE,EAAE;IACvC,MAAM,GAAG,GAAG,OAAO,CAAA;IACnB,KAAK,MAAM,CAAC,IAAI,IAAI,EAAE;QACpB,IAAI,CAAC,GAAG,CAAC,CAAC,CAAA;QACV,yDAAyD;QACzD,MAAM,OAAO,GAAG,GAAG,GAAG,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC,CAAA;QAC5D,OACE,CAAC,CAAC,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC,OAAO,CAAC,CAAC,CAAC,WAAW,EAAE,EAAE,CAAC,CAAC,CAAC,EAC3D;YACA,IAAI;gBACF,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC;oBACpB,OAAO;oBACP,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,OAAO,CAAC,MAAM,CAAC,CAAA;SACrC;QACD,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;KACrC;IACD,OAAO,IAAI,CAAA;AACb,CAAC,CAAA;AAjBY,QAAA,QAAQ,YAiBpB","sourcesContent":["import { cwd } from '@tapjs/core'\nimport { pathToFileURL } from 'node:url'\n\n// escape a string to json, then unwrap the \"\n// used for cwd detection\nconst esc = (s: string) => {\n  const j = JSON.stringify(s)\n  return j.substring(1, j.length - 1)\n}\nconst cwdURL = String(pathToFileURL(cwd)).substring('file://'.length)\nconst cwdPosix = cwd.replace(/\\\\/g, '/')\nconst cwdLcase = cwd.toLowerCase()\nconst cwdPosixLcase = cwdPosix.toLowerCase()\nconst cwds = new Set([cwdURL, cwd, cwdPosix, cwdLcase, cwdPosixLcase])\nfor (const c of [...cwds]) {\n  cwds.add(esc(c))\n  cwds.add(esc(esc(c)))\n  cwds.add(esc(esc(esc(c))))\n  cwds.add(esc(esc(esc(esc(c)))))\n}\n\nexport const cleanCWD = (snap: string) => {\n  const tag = '{CWD}'\n  for (const c of cwds) {\n    let i = -1\n    // pad it out so that the length matches through the walk\n    const replace = tag + '\\u0001'.repeat(c.length - tag.length)\n    while (\n      -1 !== (i = snap.toLowerCase().indexOf(c.toLowerCase(), i))\n    ) {\n      snap =\n        snap.substring(0, i) +\n        replace +\n        snap.substring(i + replace.length)\n    }\n    snap = snap.split(replace).join(tag)\n  }\n  return snap\n}\n"]}